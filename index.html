<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Price Monitor</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .lucide { width: 1em; height: 1em; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // Lucide icons as simple SVG components
        const Plus = () => <svg className="lucide" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>;
        const Bell = () => <svg className="lucide" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>;
        const TrendingDown = () => <svg className="lucide" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M23 18l-6-6-4 4-7-7" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 18h6v-6" /></svg>;
        const TrendingUp = () => <svg className="lucide" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M23 6l-6 6-4-4-7 7" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 6h6v6" /></svg>;
        const AlertCircle = () => <svg className="lucide" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>;
        const Calendar = () => <svg className="lucide" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const Users = () => <svg className="lucide" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" /><circle cx="9" cy="7" r="4"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M23 21v-2a4 4 0 00-3-3.87" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 3.13a4 4 0 010 7.75" /></svg>;
        const Plane = () => <svg className="lucide" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z" /><polyline points="7.5,12 16.5,12" /><polyline points="10.5,9 13.5,12 10.5,15" /></svg>;

        const { useState, useEffect } = React;

        // Load data from localStorage
        const loadFromStorage = (key, defaultValue) => {
            try {
                const stored = localStorage.getItem(key);
                return stored ? JSON.parse(stored) : defaultValue;
            } catch {
                return defaultValue;
            }
        };

        // Save data to localStorage
        const saveToStorage = (key, data) => {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.warn('Failed to save to localStorage:', e);
            }
        };

        const FlightPriceMonitor = () => {
            const [flights, setFlights] = useState(() => loadFromStorage('flights', [
                {
                    id: 1,
                    route: 'MAD → MIA',
                    dates: 'Dec 17-19 to Dec 25-27',
                    passengers: 4,
                    platforms: {
                        google: { 
                            price: 485, 
                            lastCheck: '2h ago', 
                            trend: 'down', 
                            active: true,
                            airline: 'Iberia',
                            outboundDate: 'Dec 18',
                            returnDate: 'Dec 26',
                            stops: 'Direct'
                        },
                        hopper: { 
                            price: 492, 
                            lastCheck: '1h ago', 
                            trend: 'stable', 
                            active: true,
                            airline: 'American',
                            outboundDate: 'Dec 17',
                            returnDate: 'Dec 25',
                            stops: 'Direct'
                        },
                        kayak: { 
                            price: 478, 
                            lastCheck: '3h ago', 
                            trend: 'down', 
                            active: true,
                            airline: 'Air Europa',
                            outboundDate: 'Dec 19',
                            returnDate: 'Dec 27',
                            stops: 'Direct'
                        },
                        skyscanner: { 
                            price: 501, 
                            lastCheck: '4h ago', 
                            trend: 'up', 
                            active: false,
                            airline: 'Lufthansa',
                            outboundDate: 'Dec 18',
                            returnDate: 'Dec 26',
                            stops: '1 stop'
                        }
                    },
                    lowestRecorded: 445,
                    targetPrice: 450,
                    created: '2025-08-22'
                }
            ]));

            const [showDirectOnly, setShowDirectOnly] = useState(true);
            const [newFlight, setNewFlight] = useState({
                origin: '',
                destination: '',
                departDate: '',
                returnDate: '',
                passengers: 1,
                targetPrice: ''
            });

            const [showAddForm, setShowAddForm] = useState(false);
            const [alerts, setAlerts] = useState(() => loadFromStorage('alerts', [
                {
                    id: 1,
                    message: 'MAD → MIA price dropped $12 on Kayak',
                    time: '2h ago',
                    type: 'success'
                },
                {
                    id: 2,
                    message: 'Target price of $450 almost reached',
                    time: '5h ago',
                    type: 'warning'
                }
            ]));

            // Save to localStorage whenever data changes
            useEffect(() => {
                saveToStorage('flights', flights);
            }, [flights]);

            useEffect(() => {
                saveToStorage('alerts', alerts);
            }, [alerts]);

            const getTrendIcon = (trend) => {
                switch(trend) {
                    case 'up': return <TrendingUp className="w-4 h-4 text-red-500" />;
                    case 'down': return <TrendingDown className="w-4 h-4 text-green-500" />;
                    default: return <div className="w-4 h-4 bg-gray-300 rounded-full" />;
                }
            };

            const getFilteredFlights = () => {
                if (!showDirectOnly) return flights;
                
                return flights.map(flight => ({
                    ...flight,
                    platforms: Object.fromEntries(
                        Object.entries(flight.platforms).filter(([_, data]) => 
                            !data.stops || data.stops.toLowerCase().includes('direct') || data.stops === ''
                        )
                    )
                })).filter(flight => Object.keys(flight.platforms).length > 0);
            };

            const getLowestPrice = (platforms) => {
                const prices = Object.values(platforms)
                    .filter(p => p.active && p.price > 0)
                    .map(p => p.price);
                return prices.length > 0 ? Math.min(...prices) : 0;
            };

            const addFlight = () => {
                if (!newFlight.origin || !newFlight.destination) return;
                
                const flight = {
                    id: Date.now(),
                    route: `${newFlight.origin} → ${newFlight.destination}`,
                    dates: `${newFlight.departDate} to ${newFlight.returnDate}`,
                    passengers: newFlight.passengers,
                    platforms: {
                        google: { 
                            price: 0, 
                            lastCheck: 'Not checked', 
                            trend: 'stable', 
                            active: true,
                            airline: '',
                            outboundDate: '',
                            returnDate: '',
                            stops: ''
                        },
                        hopper: { 
                            price: 0, 
                            lastCheck: 'Not checked', 
                            trend: 'stable', 
                            active: true,
                            airline: '',
                            outboundDate: '',
                            returnDate: '',
                            stops: ''
                        },
                        kayak: { 
                            price: 0, 
                            lastCheck: 'Not checked', 
                            trend: 'stable', 
                            active: true,
                            airline: '',
                            outboundDate: '',
                            returnDate: '',
                            stops: ''
                        },
                        skyscanner: { 
                            price: 0, 
                            lastCheck: 'Not checked', 
                            trend: 'stable', 
                            active: true,
                            airline: '',
                            outboundDate: '',
                            returnDate: '',
                            stops: ''
                        }
                    },
                    lowestRecorded: 0,
                    targetPrice: parseInt(newFlight.targetPrice) || 0,
                    created: new Date().toISOString().split('T')[0]
                };
                
                setFlights([...flights, flight]);
                setNewFlight({ origin: '', destination: '', departDate: '', returnDate: '', passengers: 1, targetPrice: '' });
                setShowAddForm(false);
            };

            const updatePrice = (flightId, platform, newPrice) => {
                const price = parseInt(newPrice);
                if (isNaN(price) || price <= 0) return;

                setFlights(prev => prev.map(flight => {
                    if (flight.id !== flightId) return flight;
                    
                    const updated = {
                        ...flight,
                        platforms: {
                            ...flight.platforms,
                            [platform]: {
                                ...flight.platforms[platform],
                                price: price,
                                lastCheck: 'Just now'
                            }
                        }
                    };
                    
                    // Update lowest recorded
                    const currentLowest = getLowestPrice(updated.platforms);
                    if (currentLowest > 0 && (flight.lowestRecorded === 0 || currentLowest < flight.lowestRecorded)) {
                        updated.lowestRecorded = currentLowest;
                    }
                    
                    return updated;
                }));
            };

            const openPlatform = (platform, route) => {
                const urls = {
                    google: 'https://www.google.com/travel/flights',
                    hopper: 'https://www.hopper.com/',
                    kayak: 'https://www.kayak.com/flights',
                    skyscanner: 'https://www.skyscanner.com/'
                };
                window.open(urls[platform], '_blank');
            };

            return (
                <div className="min-h-screen bg-gray-50 p-6">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-900 flex items-center gap-3">
                                        <Plane className="w-8 h-8 text-blue-600" />
                                        Flight Price Monitor
                                    </h1>
                                    <p className="text-gray-600 mt-2">Track prices across multiple platforms</p>
                                </div>
                                <button
                                    onClick={() => setShowAddForm(true)}
                                    className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700"
                                >
                                    <Plus className="w-4 h-4" />
                                    Add Flight
                                </button>
                            </div>
                        </div>

                        {/* Quick Stats */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div className="bg-white p-4 rounded-lg shadow-sm">
                                <div className="text-2xl font-bold text-blue-600">{flights.length}</div>
                                <div className="text-sm text-gray-600">Tracked Routes</div>
                            </div>
                            <div className="bg-white p-4 rounded-lg shadow-sm">
                                <div className="text-2xl font-bold text-green-600">
                                    ${flights.length > 0 ? getLowestPrice(flights[0].platforms) : 0}
                                </div>
                                <div className="text-sm text-gray-600">Lowest Current Price</div>
                            </div>
                            <div className="bg-white p-4 rounded-lg shadow-sm">
                                <div className="text-2xl font-bold text-orange-600">{alerts.length}</div>
                                <div className="text-sm text-gray-600">Active Alerts</div>
                            </div>
                            <div className="bg-white p-4 rounded-lg shadow-sm">
                                <div className="text-2xl font-bold text-purple-600">4</div>
                                <div className="text-sm text-gray-600">Platforms Monitored</div>
                            </div>
                        </div>

                        {/* Add Flight Form */}
                        {showAddForm && (
                            <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                                <h2 className="text-xl font-semibold mb-4">Add New Flight to Track</h2>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Origin</label>
                                        <input
                                            type="text"
                                            placeholder="MAD"
                                            value={newFlight.origin}
                                            onChange={(e) => setNewFlight({...newFlight, origin: e.target.value})}
                                            className="w-full p-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Destination</label>
                                        <input
                                            type="text"
                                            placeholder="MIA"
                                            value={newFlight.destination}
                                            onChange={(e) => setNewFlight({...newFlight, destination: e.target.value})}
                                            className="w-full p-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Passengers</label>
                                        <input
                                            type="number"
                                            min="1"
                                            value={newFlight.passengers}
                                            onChange={(e) => setNewFlight({...newFlight, passengers: parseInt(e.target.value)})}
                                            className="w-full p-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Departure</label>
                                        <input
                                            type="date"
                                            value={newFlight.departDate}
                                            onChange={(e) => setNewFlight({...newFlight, departDate: e.target.value})}
                                            className="w-full p-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Return</label>
                                        <input
                                            type="date"
                                            value={newFlight.returnDate}
                                            onChange={(e) => setNewFlight({...newFlight, returnDate: e.target.value})}
                                            className="w-full p-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Target Price ($)</label>
                                        <input
                                            type="number"
                                            placeholder="450"
                                            value={newFlight.targetPrice}
                                            onChange={(e) => setNewFlight({...newFlight, targetPrice: e.target.value})}
                                            className="w-full p-2 border rounded-lg"
                                        />
                                    </div>
                                </div>
                                <div className="flex gap-2 mt-4">
                                    <button
                                        onClick={addFlight}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
                                    >
                                        Add Flight
                                    </button>
                                    <button
                                        onClick={() => setShowAddForm(false)}
                                        className="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Alerts */}
                        <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                            <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                <Bell className="w-5 h-5" />
                                Recent Alerts
                            </h2>
                            <div className="space-y-3">
                                {alerts.map(alert => (
                                    <div key={alert.id} className={`p-3 rounded-lg border-l-4 ${
                                        alert.type === 'success' ? 'bg-green-50 border-green-500' : 'bg-yellow-50 border-yellow-500'
                                    }`}>
                                        <div className="flex items-center justify-between">
                                            <span className="text-sm">{alert.message}</span>
                                            <span className="text-xs text-gray-500">{alert.time}</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Flight Tracking Table */}
                        <div className="bg-white rounded-lg shadow-sm overflow-hidden">
                            <div className="p-6 border-b">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-semibold">Tracked Flights</h2>
                                    <div className="flex items-center gap-3">
                                        <label className="flex items-center gap-2 text-sm">
                                            <input
                                                type="checkbox"
                                                checked={showDirectOnly}
                                                onChange={(e) => setShowDirectOnly(e.target.checked)}
                                                className="rounded"
                                            />
                                            Show Direct Flights Only
                                        </label>
                                    </div>
                                </div>
                                {showDirectOnly && (
                                    <p className="text-sm text-gray-600 mt-2">
                                        ✈️ Filtering to show only direct flights. Platforms with connecting flights are hidden.
                                    </p>
                                )}
                            </div>
                            
                            {getFilteredFlights().map(flight => (
                                <div key={flight.id} className="p-6 border-b last:border-b-0">
                                    <div className="flex items-center justify-between mb-4">
                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-900">{flight.route}</h3>
                                            <div className="flex items-center gap-4 text-sm text-gray-600 mt-1">
                                                <span className="flex items-center gap-1">
                                                    <Calendar className="w-4 h-4" />
                                                    {flight.dates}
                                                </span>
                                                <span className="flex items-center gap-1">
                                                    <Users className="w-4 h-4" />
                                                    {flight.passengers} passengers
                                                </span>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-2xl font-bold text-green-600">
                                                ${getLowestPrice(flight.platforms) || 'N/A'}
                                            </div>
                                            <div className="text-sm text-gray-600">Current best</div>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {Object.entries(flight.platforms).map(([platform, data]) => (
                                            <div 
                                                key={platform}
                                                className={`p-4 rounded-lg border ${
                                                    data.active ? 'bg-white border-gray-200' : 'bg-gray-50 border-gray-100'
                                                }`}
                                            >
                                                <div className="flex items-center justify-between mb-3">
                                                    <span className="font-medium capitalize text-lg">{platform}</span>
                                                    {getTrendIcon(data.trend)}
                                                </div>
                                                
                                                <div className="text-2xl font-bold mb-2 text-green-600">
                                                    {data.price > 0 ? `${data.price}` : 'No data'}
                                                </div>
                                                
                                                <div className="space-y-2 mb-3">
                                                    <div className="grid grid-cols-2 gap-2 text-sm">
                                                        <div>
                                                            <span className="text-gray-500">Airline:</span>
                                                            <div className="font-medium">{data.airline || 'Not set'}</div>
                                                        </div>
                                                        <div>
                                                            <span className="text-gray-500">Stops:</span>
                                                            <div className="font-medium">{data.stops || 'Not set'}</div>
                                                        </div>
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-2 text-sm">
                                                        <div>
                                                            <span className="text-gray-500">Outbound:</span>
                                                            <div className="font-medium">{data.outboundDate || 'Not set'}</div>
                                                        </div>
                                                        <div>
                                                            <span className="text-gray-500">Return:</span>
                                                            <div className="font-medium">{data.returnDate || 'Not set'}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div className="text-xs text-gray-500 mb-3">{data.lastCheck}</div>
                                                
                                                <div className="space-y-2">
                                                    <button
                                                        onClick={() => openPlatform(platform, flight.route)}
                                                        className="w-full bg-blue-100 text-blue-700 px-3 py-2 rounded text-sm hover:bg-blue-200"
                                                    >
                                                        Check Prices
                                                    </button>
                                                    
                                                    <div className="grid grid-cols-2 gap-1">
                                                        <input
                                                            type="number"
                                                            placeholder="Price"
                                                            className="px-2 py-1 border rounded text-xs"
                                                            onKeyPress={(e) => {
                                                                if (e.key === 'Enter') {
                                                                    updatePrice(flight.id, platform, e.target.value);
                                                                    e.target.value = '';
                                                                }
                                                            }}
                                                        />
                                                        <input
                                                            type="text"
                                                            placeholder="Airline"
                                                            className="px-2 py-1 border rounded text-xs"
                                                            defaultValue={data.airline}
                                                            onBlur={(e) => updateFlightDetails(flight.id, platform, 'airline', e.target.value)}
                                                        />
                                                    </div>
                                                    
                                                    <div className="grid grid-cols-3 gap-1">
                                                        <input
                                                            type="text"
                                                            placeholder="Out date"
                                                            className="px-2 py-1 border rounded text-xs"
                                                            defaultValue={data.outboundDate}
                                                            onBlur={(e) => updateFlightDetails(flight.id, platform, 'outboundDate', e.target.value)}
                                                        />
                                                        <input
                                                            type="text"
                                                            placeholder="Return date"
                                                            className="px-2 py-1 border rounded text-xs"
                                                            defaultValue={data.returnDate}
                                                            onBlur={(e) => updateFlightDetails(flight.id, platform, 'returnDate', e.target.value)}
                                                        />
                                                        <input
                                                            type="text"
                                                            placeholder="Stops (Direct/1 stop)"
                                                            className="px-2 py-1 border rounded text-xs"
                                                            defaultValue={data.stops}
                                                            onBlur={(e) => updateFlightDetails(flight.id, platform, 'stops', e.target.value)}
                                                        />
                                                    </div>
                                                </div>
                                                
                                                {!data.active && (
                                                    <div className="text-xs text-orange-600 mt-2">Inactive</div>
                                                )}
                                            </div>
                                        ))}
                                    </div>

                                    <div className="mt-4 flex items-center justify-between text-sm">
                                        <div className="flex items-center gap-4">
                                            <span>Target: <strong>${flight.targetPrice}</strong></span>
                                            <span>Lowest recorded: <strong>${flight.lowestRecorded}</strong></span>
                                        </div>
                                        {getLowestPrice(flight.platforms) > 0 && getLowestPrice(flight.platforms) <= flight.targetPrice && (
                                            <div className="flex items-center gap-1 text-green-600">
                                                <AlertCircle className="w-4 h-4" />
                                                Target reached!
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Instructions */}
                        <div className="bg-blue-50 rounded-lg p-6 mt-6">
                            <h3 className="font-semibold text-blue-900 mb-2">How to Use This Monitor</h3>
                            <div className="bg-yellow-50 border border-yellow-200 rounded p-3 mb-3">
                                <p className="text-sm text-yellow-800"><strong>Important:</strong> This dashboard does NOT automatically fetch prices from APIs. You manually enter data after checking each platform.</p>
                                <p className="text-sm text-yellow-800 mt-1"><strong>For Direct Flights:</strong> On each platform, use their "Direct flights only" or "Nonstop" filter before searching.</p>
                            </div>
                            <ul className="text-sm text-blue-800 space-y-1">
                                <li>• <strong>Step 1:</strong> Click "Check Prices" to open flight sites in new tabs</li>
                                <li>• <strong>Step 2:</strong> On each site, filter for "Direct flights only" or "Nonstop"</li>
                                <li>• <strong>Step 3:</strong> Find the best direct flight deal on that platform</li>
                                <li>• <strong>Step 4:</strong> Come back and enter the price (press Enter)</li>
                                <li>• <strong>Step 5:</strong> Fill in airline, dates, and enter "Direct" for stops</li>
                                <li>• <strong>Step 6:</strong> Use the "Show Direct Flights Only" filter to focus your view</li>
                                <li>• All data saves automatically in your browser</li>
                                <li>• Set up official price alerts on each platform for automated notifications</li>
                            </ul>
                            <div className="mt-3 p-3 bg-green-50 border border-green-200 rounded">
                                <p className="text-sm text-green-800"><strong>Pro Tip:</strong> The real automation comes from setting up price alerts directly on Google Flights, Hopper, etc. They'll email you when prices change!</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(React.createElement(FlightPriceMonitor), document.getElementById('root'));
    </script>
</body>
</html>
